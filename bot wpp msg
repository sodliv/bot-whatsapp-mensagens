import pandas as pd
import time
import webbrowser
import pyautogui
import keyboard
import urllib.parse

# Carrega os dados do Excel
df = pd.read_excel(r'C:\\Users\\smlima\\AppData\\Local\\Microsoft\\WindowsApps\\Contatos_dependentes.xlsx')

print("Iniciando envio de mensagens...")

# Mensagem base com personaliza√ß√£o
mensagem_base = """Ol√°, {nome}. Estamos preparando uma homenagem especial para celebrar o Dia dos Pais, e a sua participa√ß√£o √© fundamental!

Para isso, pedimos que voc√™:
* Envie uma foto sua com seu(s) filho(s);
* Complete a frase "Ser pai √©...";
* Informe seu nome, o nome do(s) seu(s) filho(s) e a unidade Bundy.

üìÖ Nos envie as informa√ß√µes at√© 31/07, pelo Google Forms.

√â s√≥ clicar no link abaixo:
https://forms.gle/1y4Xqkm9RvvQEPnC9

Aguardamos sua resposta! ü•∞"""

# Loop por cada contato
for index, row in df.iterrows():
    nome = row['Nome']
    telefone = row['Telefone']

    # Personaliza a mensagem
    mensagem = mensagem_base.format(nome=nome)

    # Codifica a mensagem corretamente com todos os caracteres
    mensagem_codificada = urllib.parse.quote(mensagem)

    # Gera o link do WhatsApp com a mensagem codificada
    link = f"https://web.whatsapp.com/send?phone={telefone}&text={mensagem_codificada}"

    # Abre o navegador com o link
    webbrowser.open(link)

    print(f"Aguardando carregamento do WhatsApp para {nome}...")
    time.sleep(6)  # Aguarda 10 segundos para carregar o WhatsApp Web

    # Pressiona Enter para enviar a mensagem
    pyautogui.press("enter")

    print(f"Mensagem enviada para {nome} ({telefone})")

    time.sleep(3)  # Espera um pouco antes de passar para o pr√≥ximo
    keyboard.press_and_release('ctrl+w')  # Fecha a aba atual

print("‚úÖ Todas as mensagens foram enviadas com sucesso!")
